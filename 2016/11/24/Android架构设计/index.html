<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Android,架构,">





  <link rel="alternate" href="/atom.xml" title="森.林木" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="Android&amp;#x67B6;&amp;#x6784;&amp;#x8BBE;&amp;#x8BA1;@(Android Architecture)[&amp;#x67B6;&amp;#x6784;, Clean Architecture, MVP, MVVM, MVC] [TOC] Part1&amp;#xFF1A;&amp;#x57FA;&amp;#x7840;&amp;#x7EC4;&amp;#x4EF6;RxJava&amp;amp;RxAndroid&amp;#x51FD;&amp;#x6">
<meta name="keywords" content="Android,架构">
<meta property="og:type" content="article">
<meta property="og:title" content="Android架构设计">
<meta property="og:url" content="http://xhrong.github.io/2016/11/24/Android架构设计/index.html">
<meta property="og:site_name" content="森.林木">
<meta property="og:description" content="Android&amp;#x67B6;&amp;#x6784;&amp;#x8BBE;&amp;#x8BA1;@(Android Architecture)[&amp;#x67B6;&amp;#x6784;, Clean Architecture, MVP, MVVM, MVC] [TOC] Part1&amp;#xFF1A;&amp;#x57FA;&amp;#x7840;&amp;#x7EC4;&amp;#x4EF6;RxJava&amp;amp;RxAndroid&amp;#x51FD;&amp;#x6">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1453170845988.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452756207182.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452756229030.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/login-classes.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452756608709.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452759780153.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452760315028.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452763336648.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452763573068.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452577279271.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452577603277.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452577628918.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452577688439.png">
<meta property="og:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1452577847945.png">
<meta property="og:updated_time" content="2025-10-25T13:57:38.686Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android架构设计">
<meta name="twitter:description" content="Android&amp;#x67B6;&amp;#x6784;&amp;#x8BBE;&amp;#x8BA1;@(Android Architecture)[&amp;#x67B6;&amp;#x6784;, Clean Architecture, MVP, MVVM, MVC] [TOC] Part1&amp;#xFF1A;&amp;#x57FA;&amp;#x7840;&amp;#x7EC4;&amp;#x4EF6;RxJava&amp;amp;RxAndroid&amp;#x51FD;&amp;#x6">
<meta name="twitter:image" content="http://xhrong.github.io/2016/11/24/Android架构设计/1453170845988.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://xhrong.github.io/2016/11/24/Android架构设计/">





  <title> Android架构设计 | 森.林木 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">森.林木</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://xhrong.github.io/2016/11/24/Android架构设计/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="xhrong">
    <meta itemprop="description" content>
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="森.林木">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="森.林木" src>
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android架构设计
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-24T18:28:48+00:00">
                2016-11-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/11/24/Android架构设计/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/24/Android架构设计/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/11/24/Android架构设计/" class="leancloud_visitors" data-flag-title="Android架构设计">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;"><a href="#Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;" class="headerlink" title="Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;"></a>Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;</h1><p>@(Android Architecture)[&#x67B6;&#x6784;, Clean Architecture, MVP, MVVM, MVC]</p>
<p>[TOC]</p>
<h2 id="Part1&#xFF1A;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;"><a href="#Part1&#xFF1A;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;" class="headerlink" title="Part1&#xFF1A;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;"></a>Part1&#xFF1A;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;</h2><h3 id="RxJava-amp-RxAndroid"><a href="#RxJava-amp-RxAndroid" class="headerlink" title="RxJava&amp;RxAndroid"></a>RxJava&amp;RxAndroid</h3><p>&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x6846;&#x67B6;&#xFF0C;&#x80FD;&#x591F;&#x5C06;&#x591A;&#x5C42;&#x5D4C;&#x5957;&#x4EE3;&#x7801;&#x8F6C;&#x5316;&#x4E3A;&#x94FE;&#x5F0F;&#x51FD;&#x6570;&#x8C03;&#x7528;&#x3002;&#x7A81;&#x51FA;&#x4F18;&#x5316;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x5F88;&#x597D;&#x5730;&#x89E3;&#x51B3;&#x4E86;&#x591A;&#x7EBF;&#x7A0B;&#x4E2D;&#x7684;&#x56DE;&#x8C03;&#x6216;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x95EE;&#x9898;&#xFF0C;&#x80FD;&#x591F;&#x4EE5;&#x540C;&#x6B65;&#x94FE;&#x5F0F;&#x51FD;&#x6570;&#x8C03;&#x7528;&#xFF0C;&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x548C;&#x6570;&#x636E;&#x4E92;&#x4F20;&#xFF0C;&#x4E0D;&#x7528;&#x5728;&#x4F9D;&#x8D56;Handler&#x8FDB;&#x884C;&#x4E2D;&#x8F6C;</li>
<li>&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#xFF0C;&#x4EE3;&#x7801;&#x7B80;&#x6D01;&#xFF0C;&#x601D;&#x8DEF;&#x6E05;&#x6670;</li>
<li>&#x914D;&#x5408;Retrofit&#x7B49;&#x5E93;&#xFF0C;&#x80FD;&#x591F;&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x6E05;&#x6670;&#x7684;&#x67B6;&#x6784;&#x8BBE;&#x8BA1;<h3 id="Dagger"><a href="#Dagger" class="headerlink" title="Dagger"></a>Dagger</h3>&#x4F9D;&#x8D56;&#x6CE8;&#x5165;&#x6846;&#x67B6;&#xFF0C;&#x76EE;&#x524D;&#x7248;&#x672C;&#x4E3A;Dagger2&#xFF0C;&#x7531;Google&#x7EF4;&#x62A4;&#x3002;&#x901A;&#x8FC7;&#x751F;&#x6210;&#x4EE3;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x6027;&#x80FD;&#x8F83;&#x597D;&#x3002;&#x4F46;&#x662F;&#x6846;&#x67B6;&#x7684;&#x62BD;&#x8C61;&#x5C42;&#x6B21;&#x8F83;&#x9AD8;&#xFF0C;&#x5165;&#x95E8;&#x56F0;&#x96BE;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x5728;&#x65E5;&#x5E38;&#x9879;&#x76EE;&#x4E2D;&#x4F7F;&#x7528;&#x3002;<h3 id="Retrofit"><a href="#Retrofit" class="headerlink" title="Retrofit"></a>Retrofit</h3>&#x57FA;&#x4E8E;&#x6CE8;&#x89E3;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x5E93;&#xFF0C;&#x80FD;&#x591F;&#x81EA;&#x52A8;&#x5B8C;&#x6210;&#x6570;&#x636E;-&gt;&#x5BF9;&#x8C61;&#x7684;&#x6620;&#x5C04;&#x3002;&#x5E95;&#x5C42;&#x8BF7;&#x6C42;&#x57FA;&#x4E8E;okHttp&#x5E93;&#x3002;<strong>&#x652F;&#x6301;RxJava</strong><h3 id="dataBinder"><a href="#dataBinder" class="headerlink" title="dataBinder"></a>dataBinder</h3>MVVM&#x6A21;&#x5F0F;&#x57FA;&#x7840;&#x7EC4;&#x4EF6;&#xFF0C;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x7ED1;&#x5B9A;&#x3002;&#x4F7F;&#x7528;&#x65B9;&#x5F0F;&#x53C2;&#x89C1;MVVM&#x6A21;&#x5F0F;<h3 id="&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5E93;"><a href="#&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5E93;" class="headerlink" title="&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5E93;"></a>&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5E93;</h3></li>
</ul>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1453170845988.png" alt="Alt text"></p>
<h4 id="Universal-Image-Loader"><a href="#Universal-Image-Loader" class="headerlink" title="Universal Image Loader"></a>Universal Image Loader</h4><p>&#x4E00;&#x4E2A;&#x5F3A;&#x5927;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5E93;&#xFF0C;&#x5305;&#x542B;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x6700;&#x8001;&#x724C;&#xFF0C;&#x4F7F;&#x7528;&#x4E5F;&#x6700;&#x5E7F;&#x6CDB;&#x3002;</p>
<h4 id="Picasso"><a href="#Picasso" class="headerlink" title="Picasso"></a>Picasso</h4><p>Square&#x51FA;&#x54C1;&#xFF0C;&#x5FC5;&#x5C5E;&#x7CBE;&#x54C1;&#x3002;&#x548C;OkHttp&#x642D;&#x914D;&#x8D77;&#x6765;&#x66F4;&#x914D;&#x5466;&#xFF01;</p>
<h4 id="Volley-ImageLoader"><a href="#Volley-ImageLoader" class="headerlink" title="Volley ImageLoader"></a>Volley ImageLoader</h4><p>Google&#x5B98;&#x65B9;&#x51FA;&#x54C1;&#xFF0C;&#x53EF;&#x60DC;&#x4E0D;&#x80FD;&#x52A0;&#x8F7D;&#x672C;&#x5730;&#x56FE;&#x7247;~</p>
<h4 id="Fresco"><a href="#Fresco" class="headerlink" title="Fresco"></a>Fresco</h4><p>Facebook&#x51FA;&#x7684;&#xFF0C;&#x5929;&#x751F;&#x9A84;&#x50B2;&#xFF01;&#x4E0D;&#x662F;&#x4E00;&#x822C;&#x7684;&#x5F3A;&#x5927;&#x3002;</p>
<h4 id="Glide"><a href="#Glide" class="headerlink" title="Glide"></a>Glide</h4><p>Google&#x63A8;&#x8350;&#x7684;&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x5E93;&#xFF0C;&#x4E13;&#x6CE8;&#x4E8E;&#x6D41;&#x7545;&#x7684;&#x6EDA;&#x52A8;&#x3002;</p>
<blockquote>
<p>&#x5173;&#x6CE8;&#x6548;&#x7387;&#x548C;&#x5185;&#x5B58;&#xFF1A;Glide<br>&#x5173;&#x6CE8;&#x7EC4;&#x4EF6;&#x5927;&#x5C0F;&#x548C;&#x56FE;&#x7247;&#x8D28;&#x91CF;&#xFF1A;Picasso</p>
</blockquote>
<h2 id="Part2&#xFF1A;MVP&#xFF08;Model-View-Presenter&#xFF09;"><a href="#Part2&#xFF1A;MVP&#xFF08;Model-View-Presenter&#xFF09;" class="headerlink" title="Part2&#xFF1A;MVP&#xFF08;Model-View-Presenter&#xFF09;"></a>Part2&#xFF1A;MVP&#xFF08;Model-View-Presenter&#xFF09;</h2><p>The Model-View-Presenter design pattern is a modern pattern to separate the view from the underlying model. MVP is a derivative of the model&#x2013;view&#x2013;controller (MVC) software pattern, also used mostly for building user interfaces.</p>
<h3 id="&#x539F;&#x7406;"><a href="#&#x539F;&#x7406;" class="headerlink" title="&#x539F;&#x7406;"></a>&#x539F;&#x7406;</h3><ul>
<li>The model is the data that will be displayed in the view (user interface).</li>
<li>The view is an interface that displays data (the model) and routes user commands (events) to the presenter to act upon that data. The view usually has a reference to its presenter.</li>
<li>The presenter is the &#x201C;middle-man&#x201D; (played by the controller in MVC) and has references to both, view and model. Please note that the word &#x201C;Model&#x201D; is not correct. It should rather be business logic that retrieves or manipulates a Model For instance: If you have a database with User and your View wants to display a list of User, then the Presenter would have a reference to your database business logic (like a DAO) from where the presenter will query a list of Users.<br><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452756207182.png" alt="Alt text"></li>
</ul>
<p>A concrete workflow of querying and displaying a list of users from a database could work like this:</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452756229030.png" alt="Alt text"></p>
<p>The workflow Image shown above should be self-explaining. However here are some additional thoughts:</p>
<ul>
<li>The Presenter is not a OnClickListener. The View is responsible for handling user input and invoking the corresponding method of the presenter. Why not eliminating this &#x201C;forwarding&#x201D; process by making the Presenter an OnClickListener? If doing so the presenter needs to have knowledge about views internals. For instance, if a View has two buttons and the view registers the Presenter as OnClickListener on both, how could the Presenter distinguish which button has been clicked on a click event (without knowing views internals like the references to the button)? Model, View and Presenter should be decoupled. Furthermore, by letting Presenter implement OnClickListener the Presenter is bound to the android platform. In theory the presenter and business logic could be plain old java code, which could be shared with a desktop application or any other java application.</li>
<li>The View is only doing what the Presenter tells the View to do like you can see in step 1 and step 2: After the user has clicked on the &#x201C;load user button&#x201D; (step 1) the view doesn&#x2019;t show the loading animation directly. It&#x2019;s the presenter (step 2) who explicitly tells the view to show the loading animation. This variant of Model-View-Presenter is called MVP Passive View. The view should be as dumb as possible. Let the presenter control the view in an abstract way. For instance: presenter invokes view.showLoading() but presenter should not control view specific things like animations. So presenter should not invoke methods like view.startAnimation() etc.</li>
<li>By implementing MVP Passive View it&#x2019;s much easier to handle concurrency and multithreading. Like you can see in step 3 the database query runs async an the presenter is a Listener / Observer and gets notified when data is ready to display.</li>
</ul>
<h3 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h3><p>&#x53C2;&#x89C1;&#xFF1A;<a href="https://github.com/antoniolg/androidmvp" target="_blank" rel="noopener">https://github.com/antoniolg/androidmvp</a></p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/login-classes.png" alt="Alt text"></p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452756608709.png" alt="Alt text"></p>
<h2 id="Part3&#xFF1A;MVC"><a href="#Part3&#xFF1A;MVC" class="headerlink" title="Part3&#xFF1A;MVC"></a>Part3&#xFF1A;MVC</h2><h3 id="&#x539F;&#x7406;-1"><a href="#&#x539F;&#x7406;-1" class="headerlink" title="&#x539F;&#x7406;"></a>&#x539F;&#x7406;</h3><p>MVC&#x5168;&#x540D;&#x662F;Model View Controller&#xFF0C;&#x5982;&#x56FE;&#xFF0C;&#x662F;&#x6A21;&#x578B;(model)&#xFF0D;&#x89C6;&#x56FE;(view)&#xFF0D;&#x63A7;&#x5236;&#x5668;(controller)&#x7684;&#x7F29;&#x5199;&#xFF0C;&#x4E00;&#x79CD;&#x8F6F;&#x4EF6;&#x8BBE;&#x8BA1;&#x5178;&#x8303;&#xFF0C;&#x7528;&#x4E00;&#x79CD;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x3001;&#x6570;&#x636E;&#x3001;&#x754C;&#x9762;&#x663E;&#x793A;&#x5206;&#x79BB;&#x7684;&#x65B9;&#x6CD5;&#x7EC4;&#x7EC7;&#x4EE3;&#x7801;&#xFF0C;&#x5728;&#x6539;&#x8FDB;&#x548C;&#x4E2A;&#x6027;&#x5316;&#x5B9A;&#x5236;&#x754C;&#x9762;&#x53CA;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x7F16;&#x5199;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x3002;</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452759780153.png" alt="Alt text"></p>
<p>&#x5176;&#x4E2D;M&#x5C42;&#x5904;&#x7406;&#x6570;&#x636E;&#xFF0C;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7B49;&#xFF1B;V&#x5C42;&#x5904;&#x7406;&#x754C;&#x9762;&#x7684;&#x663E;&#x793A;&#x7ED3;&#x679C;&#xFF1B;C&#x5C42;&#x8D77;&#x5230;&#x6865;&#x6881;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x6765;&#x63A7;&#x5236;V&#x5C42;&#x548C;M&#x5C42;&#x901A;&#x4FE1;&#x4EE5;&#x6B64;&#x6765;&#x8FBE;&#x5230;&#x5206;&#x79BB;&#x89C6;&#x56FE;&#x663E;&#x793A;&#x548C;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5C42;&#x3002;</p>
<h3 id="Android&#x4E2D;&#x7684;MVC"><a href="#Android&#x4E2D;&#x7684;MVC" class="headerlink" title="Android&#x4E2D;&#x7684;MVC"></a>Android&#x4E2D;&#x7684;MVC</h3><p>Android&#x4E2D;&#x754C;&#x9762;&#x90E8;&#x5206;&#x4E5F;&#x91C7;&#x7528;&#x4E86;&#x5F53;&#x524D;&#x6BD4;&#x8F83;&#x6D41;&#x884C;&#x7684;MVC&#x6846;&#x67B6;&#xFF0C;&#x5728;Android&#x4E2D;&#xFF1A;</p>
<ul>
<li><p>&#x89C6;&#x56FE;&#x5C42;(View)<br>&#x4E00;&#x822C;&#x91C7;&#x7528;XML&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x754C;&#x9762;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x8FD9;&#x4E9B;XML&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;AndroidApp&#x7684;View&#x3002;&#x4F7F;&#x7528;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x975E;&#x5E38;&#x65B9;&#x4FBF;&#x7684;&#x5F15;&#x5165;&#x3002;&#x540C;&#x65F6;&#x4FBF;&#x4E8E;&#x540E;&#x671F;&#x754C;&#x9762;&#x7684;&#x4FEE;&#x6539;&#x3002;&#x903B;&#x8F91;&#x4E2D;&#x4E0E;&#x754C;&#x9762;&#x5BF9;&#x5E94;&#x7684;id&#x4E0D;&#x53D8;&#x5316;&#x5219;&#x4EE3;&#x7801;&#x4E0D;&#x7528;&#x4FEE;&#x6539;&#xFF0C;&#x5927;&#x5927;&#x589E;&#x5F3A;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x53EF;&#x7EF4;&#x62A4;&#x6027;&#x3002;</p>
</li>
<li><p>&#x63A7;&#x5236;&#x5C42;(Controller)<br>Android&#x7684;&#x63A7;&#x5236;&#x5C42;&#x7684;&#x91CD;&#x4EFB;&#x901A;&#x5E38;&#x843D;&#x5728;&#x4E86;&#x4F17;&#x591A;&#x7684;Activity&#x7684;&#x80A9;&#x4E0A;&#x3002;&#x8FD9;&#x53E5;&#x8BDD;&#x4E5F;&#x5C31;&#x6697;&#x542B;&#x4E86;&#x4E0D;&#x8981;&#x5728;Activity&#x4E2D;&#x5199;&#x4EE3;&#x7801;&#xFF0C;&#x8981;&#x901A;&#x8FC7;Activity&#x4EA4;&#x5272;Model&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5C42;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x539F;&#x56E0;&#x662F;Android&#x4E2D;&#x7684;Actiivity&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x662F;5s&#xFF0C;&#x5982;&#x679C;&#x8017;&#x65F6;&#x7684;&#x64CD;&#x4F5C;&#x653E;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x7A0B;&#x5E8F;&#x5C31;&#x5F88;&#x5BB9;&#x6613;&#x88AB;&#x56DE;&#x6536;&#x6389;&#x3002;</p>
</li>
<li><p>&#x6A21;&#x578B;&#x5C42;(Model)<br>&#x6211;&#x4EEC;&#x9488;&#x5BF9;&#x4E1A;&#x52A1;&#x6A21;&#x578B;&#xFF0C;&#x5EFA;&#x7ACB;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x548C;&#x76F8;&#x5173;&#x7684;&#x7C7B;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;AndroidApp&#x7684;Model&#xFF0C;Model&#x662F;&#x4E0E;View&#x65E0;&#x5173;&#xFF0C;&#x800C;&#x4E0E;&#x4E1A;&#x52A1;&#x76F8;&#x5173;&#x7684;&#xFF08;&#x611F;&#x8C22;@Xander&#x7684;&#x8BB2;&#x89E3;&#xFF09;&#x3002;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x7684;&#x64CD;&#x4F5C;&#x3001;&#x5BF9;&#x7F51;&#x7EDC;&#x7B49;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x5E94;&#x8BE5;&#x5728;Model&#x91CC;&#x9762;&#x5904;&#x7406;&#xFF0C;&#x5F53;&#x7136;&#x5BF9;&#x4E1A;&#x52A1;&#x8BA1;&#x7B97;&#x7B49;&#x64CD;&#x4F5C;&#x4E5F;&#x662F;&#x5FC5;&#x987B;&#x653E;&#x5728;&#x7684;&#x8BE5;&#x5C42;&#x7684;&#x3002;&#x5C31;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x4E8C;&#x8FDB;&#x5236;&#x7684;&#x6570;&#x636E;&#x3002;</p>
</li>
</ul>
<h3 id="Sample-1"><a href="#Sample-1" class="headerlink" title="Sample"></a>Sample</h3><p>Controller<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> <span class="keyword">implements</span> <span class="title">OnWeatherListener</span>, <span class="title">View</span>.<span class="title">OnClickListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> WeatherModel weatherModel;</span><br><span class="line">    <span class="keyword">private</span> EditText cityNOInput;</span><br><span class="line">    <span class="keyword">private</span> TextView city;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        weatherModel = <span class="keyword">new</span> WeatherModelImpl();</span><br><span class="line">        initView();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x521D;&#x59CB;&#x5316;View</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>{</span><br><span class="line">        cityNOInput = findView(R.id.et_city_no);</span><br><span class="line">        city = findView(R.id.tv_city);</span><br><span class="line">        ...</span><br><span class="line">        findView(R.id.btn_go).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x663E;&#x793A;&#x7ED3;&#x679C;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">displayResult</span><span class="params">(Weather weather)</span> </span>{</span><br><span class="line">        WeatherInfo weatherInfo = weather.getWeatherinfo();</span><br><span class="line">        city.setText(weatherInfo.getCity());</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>{</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) {</span><br><span class="line">            <span class="keyword">case</span> R.id.btn_go:</span><br><span class="line">                weatherModel.getWeather(cityNOInput.getText().toString().trim(), <span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Weather weather)</span> </span>{</span><br><span class="line">        displayResult(weather);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">()</span> </span>{</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>, &#x83B7;&#x53D6;&#x5929;&#x6C14;&#x4FE1;&#x606F;&#x5931;&#x8D25;, Toast.LENGTH_SHORT).show();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> T <span class="title">findView</span><span class="params">(<span class="keyword">int</span> id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> (T) findViewById(id);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;Activity&#x6301;&#x6709;&#x4E86;WeatherModel&#x6A21;&#x578B;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5F53;&#x7528;&#x6237;&#x6709;&#x70B9;&#x51FB;Button&#x4EA4;&#x4E92;&#x7684;&#x65F6;&#x5019;&#xFF0C;Activity&#x4F5C;&#x4E3A;Controller&#x63A7;&#x5236;&#x5C42;&#x8BFB;&#x53D6;View&#x89C6;&#x56FE;&#x5C42;EditTextView&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5411;Model&#x6A21;&#x578B;&#x53D1;&#x8D77;&#x6570;&#x636E;&#x8BF7;&#x6C42;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8C03;&#x7528;WeatherModel&#x5BF9;&#x8C61;&#x7684;&#x65B9;&#x6CD5; getWeather&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#x3002;&#x5F53;Model&#x6A21;&#x578B;&#x5904;&#x7406;&#x6570;&#x636E;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x901A;&#x8FC7;&#x63A5;&#x53E3;OnWeatherListener&#x901A;&#x77E5;View&#x89C6;&#x56FE;&#x5C42;&#x6570;&#x636E;&#x5904;&#x7406;&#x5B8C;&#x6BD5;&#xFF0C;View&#x89C6;&#x56FE;&#x5C42;&#x8BE5;&#x66F4;&#x65B0;&#x754C;&#x9762;UI&#x4E86;&#x3002;&#x7136;&#x540E;View&#x89C6;&#x56FE;&#x5C42;&#x8C03;&#x7528;displayResult&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#x66F4;&#x65B0;UI&#x3002;&#x81F3;&#x6B64;&#xFF0C;&#x6574;&#x4E2A;MVC&#x6846;&#x67B6;&#x6D41;&#x7A0B;&#x5C31;&#x5728;Activity&#x4E2D;&#x4F53;&#x73B0;&#x51FA;&#x6765;&#x4E86;&#x3002;</p>
<p>Model&#x6A21;&#x578B;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WeatherModel</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getWeather</span><span class="params">(String cityNumber, OnWeatherListener listener)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeatherModelImpl</span> <span class="keyword">implements</span> <span class="title">WeatherModel</span> </span>{</span><br><span class="line">    <span class="comment">/*&#x8FD9;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x8303;&#x4F8B;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x4E0D;&#x5E94;&#x8BE5;&#x5728;Model&#x4E2D;&#xFF0C;&#x5E94;&#x8BE5;&#x628A;&#x7F51;&#x7EDC;&#x8BBF;&#x95EE;&#x6362;&#x6210;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x8BFB;&#x53D6;*/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getWeather</span><span class="params">(String cityNumber, <span class="keyword">final</span> OnWeatherListener listener)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*&#x6570;&#x636E;&#x5C42;&#x64CD;&#x4F5C;*/</span></span><br><span class="line">        VolleyRequest.newInstance().newGsonRequest(http:<span class="comment">//www.weather.com.cn/data/sk/ + cityNumber + .html,</span></span><br><span class="line">                Weather<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">Response</span>.<span class="title">Listener</span>&lt;<span class="title">weather</span>&gt;() </span>{</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Weather weather)</span> </span>{</span><br><span class="line">                        <span class="keyword">if</span> (weather != <span class="keyword">null</span>) {</span><br><span class="line">                            listener.onSuccess(weather);</span><br><span class="line">                        } <span class="keyword">else</span> {</span><br><span class="line">                            listener.onError();</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }, <span class="keyword">new</span> Response.ErrorListener() {</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>{</span><br><span class="line">                        listener.onError();</span><br><span class="line">                    }</span><br><span class="line">                });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4EE5;&#x4E0A;&#x4EE3;&#x7801;&#x770B;&#x51FA;&#xFF0C;&#x8FD9;&#x91CC;&#x8BBE;&#x8BA1;&#x4E86;&#x4E00;&#x4E2A;WeatherModel&#x6A21;&#x578B;&#x63A5;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x5B9E;&#x73B0;&#x4E86;&#x63A5;&#x53E3;WeatherModelImpl&#x7C7B;&#x3002;controller&#x63A7;&#x5236;&#x5668;activity&#x8C03;&#x7528;WeatherModelImpl&#x7C7B;&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x53D1;&#x8D77;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x5B9E;&#x73B0;OnWeatherListener&#x63A5;&#x53E3;&#x6765;&#x83B7;&#x5F97;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x7684;&#x7ED3;&#x679C;&#x901A;&#x77E5;View&#x89C6;&#x56FE;&#x5C42;&#x66F4;&#x65B0;UI &#x3002;&#x81F3;&#x6B64;&#xFF0C;Activity&#x5C31;&#x5C06;View&#x89C6;&#x56FE;&#x663E;&#x793A;&#x548C;Model&#x6A21;&#x578B;&#x6570;&#x636E;&#x5904;&#x7406;&#x9694;&#x79BB;&#x5F00;&#x4E86;&#x3002;activity&#x62C5;&#x5F53;contronller&#x5B8C;&#x6210;&#x4E86;model&#x548C;view&#x4E4B;&#x95F4;&#x7684;&#x534F;&#x8C03;&#x4F5C;&#x7528;&#x3002;</p>
<p>&#x81F3;&#x4E8E;&#x8FD9;&#x91CC;&#x4E3A;&#x4EC0;&#x4E48;&#x4E0D;&#x76F4;&#x63A5;&#x8BBE;&#x8BA1;&#x6210;&#x7C7B;&#x91CC;&#x9762;&#x7684;&#x4E00;&#x4E2A;getWeather&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#x76F4;&#x63A5;&#x8BF7;&#x6C42;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#xFF1F;&#x4F60;&#x8003;&#x8651;&#x4E0B;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;&#x73B0;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x662F;&#x4F7F;&#x7528;Volley&#x6846;&#x67B6;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x54EA;&#x5929;&#x8001;&#x677F;&#x975E;&#x8981;&#x4F60;&#x4F7F;&#x7528;Afinal&#x6846;&#x67B6;&#x5B9E;&#x73B0;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x4F60;&#x600E;&#x4E48;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#xFF1F;&#x96BE;&#x9053;&#x662F;&#x4FEE;&#x6539; getWeather&#xFF08;&#xFF09;&#x65B9;&#x6CD5;&#x7684;&#x5B9E;&#x73B0;&#xFF1F; no no no&#xFF0C;&#x8FD9;&#x6837;&#x4FEE;&#x6539;&#x4E0D;&#x4EC5;&#x7834;&#x574F;&#x4E86;&#x4EE5;&#x524D;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x4E0D;&#x5229;&#x4E8E;&#x7EF4;&#x62A4;&#xFF0C; &#x8003;&#x8651;&#x5230;&#x4EE5;&#x540E;&#x4EE3;&#x7801;&#x7684;&#x6269;&#x5C55;&#x548C;&#x7EF4;&#x62A4;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x9009;&#x62E9;&#x8BBE;&#x8BA1;&#x63A5;&#x53E3;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x89E3;&#x51B3;&#x7740;&#x4E00;&#x4E2A;&#x95EE;&#x9898;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x73B0;&#x53E6;&#x5916;&#x4E00;&#x4E2A;WeatherModelWithAfinalImpl&#x7C7B;&#xFF0C;&#x7EE7;&#x627F;&#x81EA;WeatherModel&#xFF0C;&#x91CD;&#x5199;&#x91CC;&#x9762;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x6837;&#x4E0D;&#x4EC5;&#x4FDD;&#x7559;&#x4E86;&#x4EE5;&#x524D;&#x7684;WeatherModelImpl&#x7C7B;&#x8BF7;&#x6C42;&#x7F51;&#x7EDC;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD8;&#x589E;&#x52A0;&#x4E86;WeatherModelWithAfinalImpl&#x7C7B;&#x7684;&#x8BF7;&#x6C42;&#x65B9;&#x5F0F;&#x3002;Activity&#x8C03;&#x7528;&#x4EE3;&#x7801;&#x65E0;&#x9700;&#x8981;&#x4EFB;&#x4F55;&#x4FEE;&#x6539;&#x3002;</p>
<h3 id="MVC-&#x4E0E;-MVP&#x533A;&#x522B;"><a href="#MVC-&#x4E0E;-MVP&#x533A;&#x522B;" class="headerlink" title="MVC &#x4E0E; MVP&#x533A;&#x522B;"></a>MVC &#x4E0E; MVP&#x533A;&#x522B;</h3><p>&#x5F53;&#x6211;&#x4EEC;&#x5C06;Activity&#x590D;&#x6742;&#x7684;&#x903B;&#x8F91;&#x5904;&#x7406;&#x79FB;&#x81F3;&#x53E6;&#x5916;&#x7684;&#x4E00;&#x4E2A;&#x7C7B;&#xFF08;Presenter&#xFF09;&#x4E2D;&#x65F6;&#xFF0C;Activity&#x5176;&#x5B9E;&#x5C31;&#x662F;MVP&#x6A21;&#x5F0F;&#x4E2D;&#x7684;View&#xFF0C;&#x5B83;&#x8D1F;&#x8D23;UI&#x5143;&#x7D20;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5EFA;&#x7ACB;UI&#x5143;&#x7D20;&#x4E0E;Presenter&#x7684;&#x5173;&#x8054;&#xFF08;Listener&#x4E4B;&#x7C7B;&#xFF09;&#xFF0C;&#x540C;&#x65F6;&#x81EA;&#x5DF1;&#x4E5F;&#x4F1A;&#x5904;&#x7406;&#x4E00;&#x4E9B;&#x7B80;&#x5355;&#x7684;&#x903B;&#x8F91;&#xFF08;&#x590D;&#x6742;&#x7684;&#x903B;&#x8F91;&#x4EA4;&#x7531; Presenter&#x5904;&#x7406;&#xFF09;&#x3002;</p>
<p>MVP&#x7684;Presenter&#x662F;&#x6846;&#x67B6;&#x7684;&#x63A7;&#x5236;&#x8005;&#xFF0C;&#x627F;&#x62C5;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x903B;&#x8F91;&#x64CD;&#x4F5C;&#xFF0C;&#x800C;MVC&#x7684;Controller&#x66F4;&#x591A;&#x65F6;&#x5019;&#x627F;&#x62C5;&#x4E00;&#x79CD;&#x8F6C;&#x53D1;&#x7684;&#x4F5C;&#x7528;&#x3002;&#x56E0;&#x6B64;&#x5728;App&#x4E2D;&#x5F15;&#x5165;MVP&#x7684;&#x539F;&#x56E0;&#xFF0C;&#x662F;&#x4E3A;&#x4E86;&#x5C06;&#x6B64;&#x524D;&#x5728;Activty&#x4E2D;&#x5305;&#x542B;&#x7684;&#x5927;&#x91CF;&#x903B;&#x8F91;&#x64CD;&#x4F5C;&#x653E;&#x5230;&#x63A7;&#x5236;&#x5C42;&#x4E2D;&#xFF0C;&#x907F;&#x514D;Activity&#x7684;&#x81C3;&#x80BF;&#x3002;</p>
<p>&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x7684;&#x4E3B;&#x8981;&#x533A;&#x522B;&#xFF1A;</p>
<ul>
<li>&#xFF08;&#x6700;&#x4E3B;&#x8981;&#x533A;&#x522B;&#xFF09;View&#x4E0E;Model&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x4EA4;&#x4E92;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x4E0E;Presenter&#x4EA4;&#x4E92;&#x6765;&#x4E0E;Model&#x95F4;&#x63A5;&#x4EA4;&#x4E92;&#x3002;&#x800C;&#x5728;MVC&#x4E2D;View&#x53EF;&#x4EE5;&#x4E0E;Model&#x76F4;&#x63A5;&#x4EA4;&#x4E92;</li>
<li>&#x901A;&#x5E38;View&#x4E0E;Presenter&#x662F;&#x4E00;&#x5BF9;&#x4E00;&#x7684;&#xFF0C;&#x4F46;&#x590D;&#x6742;&#x7684;View&#x53EF;&#x80FD;&#x7ED1;&#x5B9A;&#x591A;&#x4E2A;Presenter&#x6765;&#x5904;&#x7406;&#x903B;&#x8F91;&#x3002;&#x800C;Controller&#x662F;&#x57FA;&#x4E8E;&#x884C;&#x4E3A;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x4E2A;View&#x5171;&#x4EAB;&#xFF0C;Controller&#x53EF;&#x4EE5;&#x8D1F;&#x8D23;&#x51B3;&#x5B9A;&#x663E;&#x793A;&#x54EA;&#x4E2A;View</li>
<li>Presenter&#x4E0E;View&#x7684;&#x4EA4;&#x4E92;&#x662F;&#x901A;&#x8FC7;&#x63A5;&#x53E3;&#x6765;&#x8FDB;&#x884C;&#x7684;&#xFF0C;&#x66F4;&#x6709;&#x5229;&#x4E8E;&#x6DFB;&#x52A0;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x3002;</li>
</ul>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452760315028.png" alt="Alt text"></p>
<p>&#x56E0;&#x6B64;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;MVP&#x7684;&#x4F18;&#x70B9;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>&#x6A21;&#x578B;&#x4E0E;&#x89C6;&#x56FE;&#x5B8C;&#x5168;&#x5206;&#x79BB;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4FEE;&#x6539;&#x89C6;&#x56FE;&#x800C;&#x4E0D;&#x5F71;&#x54CD;&#x6A21;&#x578B;&#xFF1B;</li>
<li>&#x53EF;&#x4EE5;&#x66F4;&#x9AD8;&#x6548;&#x5730;&#x4F7F;&#x7528;&#x6A21;&#x578B;&#xFF0C;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x7684;&#x4EA4;&#x4E92;&#x90FD;&#x53D1;&#x751F;&#x5728;&#x4E00;&#x4E2A;&#x5730;&#x65B9;&#x2014;&#x2014;Presenter&#x5185;&#x90E8;&#xFF1B;</li>
<li>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5C06;&#x4E00;&#x4E2A;Presenter&#x7528;&#x4E8E;&#x591A;&#x4E2A;&#x89C6;&#x56FE;&#xFF0C;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x6539;&#x53D8;Presenter&#x7684;&#x903B;&#x8F91;&#x3002;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x975E;&#x5E38;&#x7684;&#x6709;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x89C6;&#x56FE;&#x7684;&#x53D8;&#x5316;&#x603B;&#x662F;&#x6BD4;&#x6A21;&#x578B;&#x7684;&#x53D8;&#x5316;&#x9891;&#x7E41;&#xFF1B;</li>
<li>&#x5982;&#x679C;&#x6211;&#x4EEC;&#x628A;&#x903B;&#x8F91;&#x653E;&#x5728;Presenter&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x8131;&#x79BB;&#x7528;&#x6237;&#x63A5;&#x53E3;&#x6765;&#x6D4B;&#x8BD5;&#x8FD9;&#x4E9B;&#x903B;&#x8F91;&#xFF08;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#xFF09;&#x3002;</li>
</ul>
<p>&#x5177;&#x4F53;&#x5230;Android App&#x4E2D;&#xFF0C;&#x4E00;&#x822C;&#x53EF;&#x4EE5;&#x5C06;App&#x6839;&#x636E;&#x7A0B;&#x5E8F;&#x7684;&#x7ED3;&#x6784;&#x8FDB;&#x884C;&#x7EB5;&#x5411;&#x5212;&#x5206;&#xFF0C;&#x6839;&#x636E;MVP&#x53EF;&#x4EE5;&#x5C06;App&#x5206;&#x522B;&#x4E3A;&#x6A21;&#x578B;&#x5C42;(M)&#xFF0C;UI&#x5C42;(V)&#x548C;&#x903B;&#x8F91;&#x5C42;(P)&#x3002;</p>
<p>UI&#x5C42;&#x4E00;&#x822C;&#x5305;&#x62EC;Activity&#xFF0C;Fragment&#xFF0C;Adapter&#x7B49;&#x76F4;&#x63A5;&#x548C;UI&#x76F8;&#x5173;&#x7684;&#x7C7B;&#xFF0C;UI&#x5C42;&#x7684;Activity&#x5728;&#x542F;&#x52A8;&#x4E4B;&#x540E;&#x5B9E;&#x4F8B;&#x5316;&#x76F8;&#x5E94;&#x7684;Presenter&#xFF0C;App&#x7684;&#x63A7;&#x5236;&#x6743;&#x540E;&#x79FB;&#xFF0C;&#x7531;UI&#x8F6C;&#x79FB;&#x5230;Presenter&#xFF0C;&#x4E24;&#x8005;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x4FE1;&#x901A;&#x8FC7;BroadCast&#x3001;Handler&#x6216;&#x8005;&#x63A5;&#x53E3;&#x5B8C;&#x6210;&#xFF0C;&#x53EA;&#x4F20;&#x9012;&#x4E8B;&#x4EF6;&#x548C;&#x7ED3;&#x679C;&#x3002;</p>
<p>&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;UI&#x5C42;&#x901A;&#x77E5;&#x903B;&#x8F91;&#x5C42;&#xFF08;Presenter&#xFF09;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x4E86;&#x4E00;&#x4E2A;Button&#xFF0C;&#x903B;&#x8F91;&#x5C42;&#xFF08;Presenter&#xFF09;&#x81EA;&#x5DF1;&#x51B3;&#x5B9A;&#x5E94;&#x8BE5;&#x7528;&#x4EC0;&#x4E48;&#x884C;&#x4E3A;&#x8FDB;&#x884C;&#x54CD;&#x5E94;&#xFF0C;&#x8BE5;&#x627E;&#x54EA;&#x4E2A;&#x6A21;&#x578B;&#xFF08;Model&#xFF09;&#x53BB;&#x505A;&#x8FD9;&#x4EF6;&#x4E8B;&#xFF0C;&#x6700;&#x540E;&#x903B;&#x8F91;&#x5C42;&#xFF08;Presenter&#xFF09;&#x5C06;&#x5B8C;&#x6210;&#x7684;&#x7ED3;&#x679C;&#x66F4;&#x65B0;&#x5230;UI&#x5C42;&#x3002;</p>
<blockquote>
<p>&#x5907;&#x6CE8;&#xFF1A;Android&#x672C;&#x8EAB;&#x91C7;&#x7528;&#x7684;&#x5C31;&#x662F;MVC&#x6A21;&#x5F0F;&#xFF0C;&#x6240;&#x4EE5;&#x6CA1;&#x6709;&#x5FC5;&#x8981;&#x5728;&#x523B;&#x610F;&#x7528;MVC&#x67B6;&#x6784;&#x4E86;</p>
</blockquote>
<h2 id="Part4&#xFF1A;MVVM"><a href="#Part4&#xFF1A;MVVM" class="headerlink" title="Part4&#xFF1A;MVVM"></a>Part4&#xFF1A;MVVM</h2><h3 id="&#x539F;&#x7406;-2"><a href="#&#x539F;&#x7406;-2" class="headerlink" title="&#x539F;&#x7406;"></a>&#x539F;&#x7406;</h3><p>MVVM&#x53EF;&#x4EE5;&#x7B97;&#x662F;MVP&#x7684;&#x5347;&#x7EA7;&#x7248;&#xFF0C;&#x5176;&#x4E2D;&#x7684;VM&#x662F;ViewModel&#x7684;&#x7F29;&#x5199;&#xFF0C;ViewModel&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x6210;&#x662F;View&#x7684;&#x6570;&#x636E;&#x6A21;&#x578B;&#x548C;Presenter&#x7684;&#x5408;&#x4F53;&#xFF0C;ViewModel&#x548C;View&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x901A;&#x8FC7;Data Binding&#x5B8C;&#x6210;&#xFF0C;&#x800C;Data Binding&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x53CC;&#x5411;&#x7684;&#x4EA4;&#x4E92;&#xFF0C;&#x8FD9;&#x5C31;&#x4F7F;&#x5F97;&#x89C6;&#x56FE;&#x548C;&#x63A7;&#x5236;&#x5C42;&#x4E4B;&#x95F4;&#x7684;&#x8026;&#x5408;&#x7A0B;&#x5EA6;&#x8FDB;&#x4E00;&#x6B65;&#x964D;&#x4F4E;&#xFF0C;&#x5173;&#x6CE8;&#x70B9;&#x5206;&#x79BB;&#x66F4;&#x4E3A;&#x5F7B;&#x5E95;&#xFF0C;&#x540C;&#x65F6;&#x51CF;&#x8F7B;&#x4E86;Activity&#x7684;&#x538B;&#x529B;&#x3002;</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452763336648.png" alt="Alt text"></p>
<p>&#x5728;&#x6BD4;&#x8F83;&#x4E4B;&#x524D;&#xFF0C;&#x5148;&#x4ECE;&#x56FE;&#x4E0A;&#x770B;&#x770B;&#x4E09;&#x8005;&#x7684;&#x5F02;&#x540C;&#x3002;</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452763573068.png" alt="Alt text"></p>
<p>&#x521A;&#x5F00;&#x59CB;&#x7406;&#x89E3;&#x8FD9;&#x4E9B;&#x6982;&#x5FF5;&#x7684;&#x65F6;&#x5019;&#x8BA4;&#x4E3A;&#x8FD9;&#x51E0;&#x79CD;&#x6A21;&#x5F0F;&#x867D;&#x7136;&#x90FD;&#x662F;&#x8981;&#x5C06;view&#x548C;model&#x89E3;&#x8026;&#xFF0C;&#x4F46;&#x662F;&#x975E;&#x6B64;&#x5373;&#x5F7C;&#xFF0C;&#x6CA1;&#x6709;&#x5173;&#x7CFB;&#xFF0C;&#x4E00;&#x4E2A;&#x5E94;&#x7528;&#x53EA;&#x4F1A;&#x7528;&#x4E00;&#x79CD;&#x6A21;&#x5F0F;&#x3002;&#x540E;&#x6765;&#x6162;&#x6162;&#x53D1;&#x73B0;&#x4E16;&#x754C;&#x7EDD;&#x5BF9;&#x4E0D;&#x662F;&#x53EA;&#x6709;&#x9ED1;&#x767D;&#x4E24;&#x9762;&#xFF0C;&#x4E2D;&#x95F4;&#x6700;&#x5927;&#x7684;&#x4E00;&#x5757;&#x5176;&#x5B9E;&#x662F;&#x7070;&#x8272;&#x5730;&#x5E26;&#xFF0C;&#x540C;&#x6837;&#xFF0C;&#x8FD9;&#x51E0;&#x79CD;&#x6A21;&#x5F0F;&#x7684;&#x8FB9;&#x754C;&#x5E76;&#x975E;&#x90A3;&#x4E48;&#x660E;&#x663E;&#xFF0C;&#x53EF;&#x80FD;&#x4F60;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x5E94;&#x7528;&#x4E2D;&#x90FD;&#x4F1A;&#x7528;&#x5230;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x4E5F;&#x6839;&#x672C;&#x6CA1;&#x5FC5;&#x8981;&#x53BB;&#x7EA0;&#x7ED3;&#x81EA;&#x5DF1;&#x5230;&#x5E95;&#x7528;&#x7684;&#x662F;MVC&#x3001;MVP&#x8FD8;&#x662F;MVVP&#xFF0C;&#x4E0D;&#x7BA1;&#x9ED1;&#x732B;&#x767D;&#x732B;&#xFF0C;&#x6349;&#x4F4F;&#x8001;&#x9F20;&#x5C31;&#x662F;&#x597D;&#x732B;&#x3002;</p>
<h3 id="Sample-2"><a href="#Sample-2" class="headerlink" title="Sample"></a>Sample</h3><p>&#x53C2;&#x89C1;&#xFF1A;<a href="https://developer.android.com/intl/zh-cn/tools/data-binding/guide.html" target="_blank" rel="noopener">https://developer.android.com/intl/zh-cn/tools/data-binding/guide.html</a></p>
<p>Layout<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">variable</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.example.User&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:text</span>=<span class="string">&quot;@{user.firstName}&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">TextView</span> <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">android:text</span>=<span class="string">&quot;@{user.lastName}&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Data Object</p>
<p>Let&#x2019;s assume for now that you have a plain-old Java object (POJO) for User:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> String firstName;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> String lastName;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String firstName, String lastName)</span> </span>{</span><br><span class="line">       <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">       <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">   }</span><br><span class="line">}</span><br><span class="line">This type of object has data that never changes. It is common in applications to have data that is read once and never changes thereafter. It is also possible to use a JavaBeans objects:</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String firstName;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String lastName;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String firstName, String lastName)</span> </span>{</span><br><span class="line">       <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">       <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">   }</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>{</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.firstName;</span><br><span class="line">   }</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>{</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.lastName;</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<p>From the perspective of data binding, these two classes are equivalent. The expression @{user.firstName} used for the TextView&#x2019;s android:text attribute will access the firstName field in the former class and the getFirstName() method in the latter class. Alternatively, it will also be resolved to firstName() if that method exists.</p>
<p>Binding Data</p>
<p>By default, a Binding class will be generated based on the name of the layout file, converting it to Pascal case and suffixing &#x201C;Binding&#x201D; to it. The above layout file was main_activity.xml so the generate class was MainActivityBinding. This class holds all the bindings from the layout properties (e.g. the user variable) to the layout&#x2019;s Views and knows how to assign values for the binding expressions.The easiest means for creating the bindings is to do it while inflating:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">   <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">   MainActivityBinding binding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.main_activity);</span><br><span class="line">   User user = <span class="keyword">new</span> User(<span class="string">&quot;Test&quot;</span>, <span class="string">&quot;User&quot;</span>);</span><br><span class="line">   binding.setUser(user);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p>
<h3 id="MVC-gt-MVP-gt-MVVM&#x6F14;&#x8FDB;&#x8FC7;&#x7A0B;"><a href="#MVC-gt-MVP-gt-MVVM&#x6F14;&#x8FDB;&#x8FC7;&#x7A0B;" class="headerlink" title="MVC-&gt;MVP-&gt;MVVM&#x6F14;&#x8FDB;&#x8FC7;&#x7A0B;"></a>MVC-&gt;MVP-&gt;MVVM&#x6F14;&#x8FDB;&#x8FC7;&#x7A0B;</h3><p>MVC -&gt; MVP -&gt; MVVM &#x8FD9;&#x51E0;&#x4E2A;&#x8F6F;&#x4EF6;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x662F;&#x4E00;&#x6B65;&#x6B65;&#x6F14;&#x5316;&#x53D1;&#x5C55;&#x7684;&#xFF0C;MVVM &#x662F;&#x4ECE; MVP &#x7684;&#x8FDB;&#x4E00;&#x6B65;&#x53D1;&#x5C55;&#x4E0E;&#x89C4;&#x8303;&#xFF0C;MVP &#x9694;&#x79BB;&#x4E86;MVC&#x4E2D;&#x7684; M &#x4E0E; V &#x7684;&#x76F4;&#x63A5;&#x8054;&#x7CFB;&#x540E;&#xFF0C;&#x9760; Presenter &#x6765;&#x4E2D;&#x8F6C;&#xFF0C;&#x6240;&#x4EE5;&#x4F7F;&#x7528; MVP &#x65F6; P &#x662F;&#x76F4;&#x63A5;&#x8C03;&#x7528; View &#x7684;&#x63A5;&#x53E3;&#x6765;&#x5B9E;&#x73B0;&#x5BF9;&#x89C6;&#x56FE;&#x7684;&#x64CD;&#x4F5C;&#x7684;&#xFF0C;&#x8FD9;&#x4E2A; View &#x63A5;&#x53E3;&#x7684;&#x4E1C;&#x897F;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#x662F; showData&#x3001;showLoading&#x7B49;&#x7B49;&#x3002;M &#x4E0E; V&#x5DF2;&#x7ECF;&#x9694;&#x79BB;&#x4E86;&#xFF0C;&#x65B9;&#x4FBF;&#x6D4B;&#x8BD5;&#x4E86;&#xFF0C;&#x4F46;&#x4EE3;&#x7801;&#x8FD8;&#x4E0D;&#x591F;&#x4F18;&#x96C5;&#x7B80;&#x6D01;&#xFF0C;&#x6240;&#x4EE5; MVVM &#x5C31;&#x5F25;&#x8865;&#x4E86;&#x8FD9;&#x4E9B;&#x7F3A;&#x9677;&#x3002;&#x5728; MVVM &#x4E2D;&#x5C31;&#x51FA;&#x73B0;&#x7684; Data Binding &#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x610F;&#x601D;&#x5C31;&#x662F; View &#x63A5;&#x53E3;&#x7684; showData &#x8FD9;&#x4E9B;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x4E0D;&#x5199;&#x4E86;&#xFF0C;&#x901A;&#x8FC7; Binding &#x6765;&#x5B9E;&#x73B0;&#x3002;</p>
<p>&#x4E09;&#x8005;&#x7684;&#x5DEE;&#x5F02;&#x5728;&#x4E8E;&#x5982;&#x4F55;&#x7C98;&#x5408;View&#x548C;Model&#xFF0C;&#x5B9E;&#x73B0;&#x7528;&#x6237;&#x7684;&#x4EA4;&#x4E92;&#x64CD;&#x4F5C;&#x4EE5;&#x53CA;&#x53D8;&#x66F4;&#x901A;&#x77E5;</p>
<ul>
<li><p>Controller&#xFF08;MVC&#xFF09;<br>Controller&#x63A5;&#x6536;View&#x7684;&#x64CD;&#x4F5C;&#x4E8B;&#x4EF6;&#xFF0C;&#x6839;&#x636E;&#x4E8B;&#x4EF6;&#x4E0D;&#x540C;&#xFF0C;&#x6216;&#x8005;&#x8C03;&#x7528;Model&#x7684;&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#xFF0C;&#x6216;&#x8005;&#x8FDB;&#x884C;View&#x7684;&#x8DF3;&#x8F6C;&#xFF0C;&#x4ECE;&#x800C;&#x4E5F;&#x610F;&#x5473;&#x7740;&#x4E00;&#x4E2A;Controller&#x53EF;&#x4EE5;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;View&#x3002;Controller&#x5BF9;View&#x7684;&#x5B9E;&#x73B0;&#x4E0D;&#x592A;&#x5173;&#x5FC3;&#xFF0C;&#x53EA;&#x4F1A;&#x88AB;&#x52A8;&#x5730;&#x63A5;&#x6536;&#xFF0C;Model&#x7684;&#x6570;&#x636E;&#x53D8;&#x66F4;&#x4E0D;&#x901A;&#x8FC7;Controller&#x76F4;&#x63A5;&#x901A;&#x77E5;View&#xFF0C;&#x901A;&#x5E38;View&#x91C7;&#x7528;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x76D1;&#x542C;Model&#x7684;&#x53D8;&#x5316;&#x3002;</p>
</li>
<li><p>Presenter&#xFF08;MVP&#xFF09;<br>Presenter&#x4E0E;Controller&#x4E00;&#x6837;&#xFF0C;&#x63A5;&#x6536;View&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x5BF9;Model&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF1B;&#x4E0E;Controller&#x4E0D;&#x540C;&#x7684;&#x662F;Presenter&#x4F1A;&#x53CD;&#x4F5C;&#x7528;&#x4E8E;View&#xFF0C;Model&#x7684;&#x53D8;&#x66F4;&#x901A;&#x77E5;&#x9996;&#x5148;&#x88AB;Presenter&#x83B7;&#x5F97;&#xFF0C;&#x7136;&#x540E;Presenter&#x518D;&#x53BB;&#x66F4;&#x65B0;View&#x3002;&#x4E00;&#x4E2A;Presenter&#x53EA;&#x5BF9;&#x5E94;&#x4E8E;&#x4E00;&#x4E2A;View&#x3002;&#x6839;&#x636E;Presenter&#x548C;View&#x5BF9;&#x903B;&#x8F91;&#x4EE3;&#x7801;&#x5206;&#x62C5;&#x7684;&#x7A0B;&#x5EA6;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x53C8;&#x6709;&#x4E24;&#x79CD;&#x60C5;&#x51B5;&#xFF1A;Passive View&#x548C;Supervisor Controller&#x3002;</p>
</li>
<li><p>ViewModel&#xFF08;MVVM&#xFF09;<br>&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x7684;&#x201C;Model&#x201D;&#x6307;&#x7684;&#x662F;View&#x7684;Model&#xFF0C;&#x8DDF;MVVM&#x4E2D;&#x7684;&#x4E00;&#x4E2A;Model&#x4E0D;&#x662F;&#x4E00;&#x56DE;&#x4E8B;&#x3002;&#x6240;&#x8C13;View&#x7684;Model&#x5C31;&#x662F;&#x5305;&#x542B;View&#x7684;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x5C5E;&#x6027;&#x548C;&#x64CD;&#x4F5C;&#x7684;&#x8FD9;&#x4E48;&#x4E00;&#x4E2A;&#x4E1C;&#x4E1C;&#xFF0C;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x7684;&#x5173;&#x952E;&#x6280;&#x672F;&#x5C31;&#x662F;&#x6570;&#x636E;&#x7ED1;&#x5B9A;&#xFF08;data binding&#xFF09;&#xFF0C;View&#x7684;&#x53D8;&#x5316;&#x4F1A;&#x76F4;&#x63A5;&#x5F71;&#x54CD;ViewModel&#xFF0C;ViewModel&#x7684;&#x53D8;&#x5316;&#x6216;&#x8005;&#x5185;&#x5BB9;&#x4E5F;&#x4F1A;&#x76F4;&#x63A5;&#x4F53;&#x73B0;&#x5728;View&#x4E0A;&#x3002;&#x8FD9;&#x79CD;&#x6A21;&#x5F0F;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x6846;&#x67B6;&#x66FF;&#x5E94;&#x7528;&#x5F00;&#x53D1;&#x8005;&#x505A;&#x4E86;&#x4E00;&#x4E9B;&#x5DE5;&#x4F5C;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EA;&#x9700;&#x8981;&#x8F83;&#x5C11;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x80FD;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>
</li>
</ul>
<h2 id="Part5&#xFF1A;Clean-Architecture"><a href="#Part5&#xFF1A;Clean-Architecture" class="headerlink" title="Part5&#xFF1A;Clean Architecture"></a>Part5&#xFF1A;Clean Architecture</h2><p>clean architecture&#xFF1A;stands for a group of practices that produce systems that are:</p>
<ul>
<li>Independent of Frameworks.</li>
<li>Testable.</li>
<li>Independent of UI.</li>
<li>Independent of Database.</li>
<li>Independent of any external agency.**</li>
</ul>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452577279271.png" alt="Alt text"></p>
<p>It is not a must to use only 4 circles (as you can see in the picture), because they are only schematic but you should take into consideration the Dependency Rule: source code dependencies can only point inwards and nothing in an inner circle can know anything at all about something in an outer circle.</p>
<p>Here is some vocabulary that is relevant for getting familiar and understanding this approach in a better way:</p>
<ul>
<li><strong>Entities</strong>: These are the business objects of the application.</li>
<li><strong>Use Cases</strong>: These use cases orchestrate the flow of data to and from the entities. Are also called Interactors.</li>
<li><strong>Interface Adapters</strong>: This set of adapters convert data from the format most convenient for the use cases and entities. Presenters and Controllers belong here.</li>
<li><strong>Frameworks and Drivers</strong>: This is where all the details go: UI, tools, frameworks, etc.</li>
</ul>
<p>The objective is the separation of concerns by keeping the business rules not knowing anything at all about the outside world, thus, they can can be tested without any dependency to any external element.<br>To achieve this, my proposal is about breaking up the project into 3 different layers, in which each one has its own purpose and works separately from the others.<br>It is worth mentioning that each layer uses its own data model so this independence can be reached (you will see in code that a data mapper is needed in order to accomplish data transformation, a price to be paid if you do not want to cross the use of your models over the entire application).<br>Here is an schema so you can see how it looks like:</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452577603277.png" alt="Alt text"></p>
<p>NOTE: I did not use any external library (except gson for parsing json data and junit, mockito, robolectric and espresso for testing). The reason was because it made the example a bit more clear. Anyway do not hesitate to add ORMs for storing disk data or any dependency injection framework or whatever tool or library you are familiar with, that could make your life easier. (Remember that reinventing the wheel is not a good practice).</p>
<h3 id="Presentation-Layer"><a href="#Presentation-Layer" class="headerlink" title="Presentation Layer"></a>Presentation Layer</h3><p>Is here, where the logic related with views and animations happens. It uses no more than a Model View Presenter (MVP from now on), but you can use any other pattern like MVC or MVVM. I will not get into details on it, but here fragments and activities are only views, there is no logic inside them other than UI logic, and this is where all the rendering stuff takes place.<br>Presenters in this layer are composed with interactors (use cases) that perform the job in a new thread outside the android UI thread, and come back using a callback with the data that will be rendered in the view.</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452577628918.png" alt="Alt text"></p>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x6BD4;&#x8F83;&#x7075;&#x6D3B;&#xFF0C;&#x53EF;&#x91C7;&#x7528;&#x5404;&#x79CD;&#x6A21;&#x5F0F;&#xFF0C;&#x5982;MVP&#x3001;MVVM&#x3001;MVC&#x7B49;&#xFF0C;&#x4E5F;&#x53EF;&#x7528;&#x4E0D;&#x6A21;&#x5F0F;</p>
</blockquote>
<h3 id="Domain-Layer"><a href="#Domain-Layer" class="headerlink" title="Domain Layer"></a>Domain Layer</h3><p>Business rules here: all the logic happens in this layer. Regarding the android project, you will see all the interactors (use cases) implementations here as well.<br>This layer is a pure java module without any android dependencies. All the external components use interfaces when connecting to the business objects.</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452577688439.png" alt="Alt text"></p>
<blockquote>
<p>&#x8FD9;&#x91CC;&#x7528;&#x6765;&#x88C5;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#xFF0C;&#x548C;BLL&#x6839;&#x636E;&#x76F8;&#x4F3C;</p>
</blockquote>
<h3 id="Data-Layer"><a href="#Data-Layer" class="headerlink" title="Data Layer"></a>Data Layer</h3><p>All data needed for the application comes from this layer through a UserRepository implementation (the interface is in the domain layer) that uses a Repository Pattern with a strategy that, through a factory, picks different data sources depending on certain conditions.<br>For instance, when getting a user by id, the disk cache data source will be selected if the user already exists in cache, otherwise the cloud will be queried to retrieve the data and later save it to the disk cache.<br>The idea behind all this is that the data origin is transparent for the client, which does not care if the data is coming from memory, disk or the cloud, the only truth is that the data will arrive and will be got.</p>
<p><img src="/2016/11/24/Android&#x67B6;&#x6784;&#x8BBE;&#x8BA1;/1452577847945.png" alt="Alt text"></p>
<blockquote>
<p>&#x8FD9;&#x4E2A;&#x5C42;&#x7528;&#x6765;&#x5904;&#x7406;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x95EE;&#x9898;&#xFF0C;&#x4F7F;&#x7528;Repository&#x6A21;&#x5F0F;&#x5B9E;&#x73B0;&#x6570;&#x636E;&#x6E90;&#x7684;&#x5C01;&#x88C5;</p>
</blockquote>
<h3 id="Error-Handling"><a href="#Error-Handling" class="headerlink" title="Error Handling"></a>Error Handling</h3><p>This is always a topic for discussion and could be great if you share your solutions here.<br>My strategy was to use callbacks, thus, if something happens in the data repository for example, the callback has 2 methods onResponse() and onError(). The last one encapsulates exceptions in a wrapper class called &#x201C;ErrorBundle&#x201D;: This approach brings some difficulties because there is a chains of callbacks one after the other until the error goes to the presentation layer to be rendered. Code readability could be a bit compromised.</p>
<blockquote>
<p>&#x4F7F;&#x7528;callback&#x65B9;&#x5F0F;&#x4E5F;&#x5904;&#x7406;&#x5F02;&#x5E38;&#xFF0C;&#x5E76;&#x4E0D;&#x5408;&#x9002;&#xFF0C;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x94FE;&#x8F83;&#x957F;&#xFF0C;&#x4E0D;&#x597D;&#x7528;&#x3002;&#x53EF;&#x8003;&#x8651;&#x4F7F;&#x7528;EventBus&#x6765;&#x5206;&#x53D1;</p>
</blockquote>
<h2 id="Part6&#xFF1A;Tips"><a href="#Part6&#xFF1A;Tips" class="headerlink" title="Part6&#xFF1A;Tips"></a>Part6&#xFF1A;Tips</h2><h3 id="1&#x3001;&#x5B50;&#x7EBF;&#x7A0B;&#x56DE;&#x8C03;&#x66F4;&#x65B0;UI&#x95EE;&#x9898;"><a href="#1&#x3001;&#x5B50;&#x7EBF;&#x7A0B;&#x56DE;&#x8C03;&#x66F4;&#x65B0;UI&#x95EE;&#x9898;" class="headerlink" title="1&#x3001;&#x5B50;&#x7EBF;&#x7A0B;&#x56DE;&#x8C03;&#x66F4;&#x65B0;UI&#x95EE;&#x9898;"></a>1&#x3001;&#x5B50;&#x7EBF;&#x7A0B;&#x56DE;&#x8C03;&#x66F4;&#x65B0;UI&#x95EE;&#x9898;</h3><p><strong>&#x95EE;&#x9898;&#x63CF;&#x8FF0;</strong>&#xFF1A;</p>
<p>&#x901A;&#x8FC7;&#x5B9A;&#x4E49;&#x56DE;&#x8C03;&#x63A5;&#x53E3;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x5B50;&#x7EBF;&#x4E2D;&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#xFF0C;&#x5B9E;&#x73B0;&#x72B6;&#x6001;&#x901A;&#x77E5;&#x3002;&#x4F8B;&#x5982;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5728;&#x8BF7;&#x6C42;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FDB;&#x884C;&#x56DE;&#x8C03;onSuccess&#x3001;onError&#x7B49;&#xFF0C;&#x7531;&#x4E8E;&#x662F;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x8C03;&#x7528;&#x7684;&#xFF0C;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x8FD0;&#x884C;&#x3002;&#x5982;&#x679C;&#x5728;&#x56DE;&#x8C03;&#x4E2D;&#x66F4;&#x65B0;UI&#xFF0C;&#x6B64;&#x65F6;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x66F4;&#x65B0;UI&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x5F15;&#x53D1;&#x5F02;&#x5E38;&#x3002;</p>
<p><strong>&#x5904;&#x7406;&#x65B9;&#x6CD5;</strong>&#xFF1A;<br>&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x6709;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#xFF0C;&#x524D;&#x4E24;&#x79CD;&#x5229;&#x7528;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;Handler&#xFF0C;&#x540E;&#x4E00;&#x79CD;&#x5229;&#x7528;RxJava&#x6846;&#x67B6;&#x3002;&#xFF08;&#x8FD9;&#x91CC;&#x53EA;&#x662F;&#x63D0;&#x4F9B;&#x4E09;&#x79CD;&#x65B9;&#x6848;&#xFF0C;&#x5F53;&#x7136;&#x8FD8;&#x6709;&#x5176;&#x5B83;&#x65B9;&#x6848;&#xFF0C;&#x5982;&#x5229;&#x7528;EventBus&#xFF09;</p>
<p>&#x65B9;&#x6CD5;&#x4E00;&#xFF1A;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F20;&#x5165;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;Handler&#xFF0C;&#x5728;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x8C03;&#x7528;Handler.postMessage&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x901A;&#x77E5;&#x3002;&#x5728;Handler&#x7684;handlerMessage&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#xFF0C;&#x6B64;&#x65F6;&#xFF0C;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;</p>
<p>Sample:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhr.mvpdemo.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.Looper;</span><br><span class="line"><span class="keyword">import</span> android.os.Message;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xhrong on 2016/1/12.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &#x8FD9;&#x4E2A;&#x7C7B;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x79CD;&#x89E3;&#x51B3;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x6267;&#x884C;&#x56DE;&#x8C03;&#x66F4;&#x65B0;UI&#x7684;&#x5B9E;&#x73B0;&#x6A21;&#x5F0F;&#x3002;&#x5373;&#x7EBF;&#x7A0B;&#x4E2D;&#x8C03;&#x7528;sendMessage&#xFF0C;&#x56DE;&#x8C03;&#x7C7B;&#x901A;&#x8FC7;Handler&#x4E2D;&#x8F6C;&#xFF0C;&#x5B9E;&#x73B0;&#x5B50;&#x7EBF;&#x79CD;&#x4E0E;UI&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;&#x3002;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">OnUserRepoListener</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler handler;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SUCCESS_MESSAGE = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FAILURE_MESSAGE = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onFail</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OnUserRepoListener</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//&#x901A;&#x8FC7;handler&#x5B9E;&#x73B0;&#x5B50;&#x7EBF;&#x7A0B;&#x548C;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;&#x5207;&#x6362;</span></span><br><span class="line">        handler = <span class="keyword">new</span> ResponderHandler (<span class="keyword">this</span>, Looper.myLooper());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Helper method to create Message instance from handler</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> responseMessageId   constant to identify Handler message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> responseMessageData object to be passed to message receiver</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Message instance, should not be null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Message <span class="title">obtainMessage</span><span class="params">(<span class="keyword">int</span> responseMessageId, Object responseMessageData)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> Message.obtain(handler, responseMessageId, responseMessageData);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSuccessMessage</span><span class="params">()</span> </span>{</span><br><span class="line">        sendMessage(obtainMessage(SUCCESS_MESSAGE, <span class="keyword">null</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendFailMessage</span><span class="params">()</span> </span>{</span><br><span class="line">        sendMessage(obtainMessage(FAILURE_MESSAGE, <span class="keyword">null</span>));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Methods which emulate android&apos;s Handler and Message methods</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message message)</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">switch</span> (message.what) {</span><br><span class="line">                <span class="keyword">case</span> SUCCESS_MESSAGE:</span><br><span class="line">                    onSuccess();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> FAILURE_MESSAGE:</span><br><span class="line">                    onFail();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (Throwable error) {</span><br><span class="line">            onFail();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (handler != <span class="keyword">null</span> &amp;&amp; !Thread.currentThread().isInterrupted()) { <span class="comment">// do not send messages if request has been cancelled</span></span><br><span class="line">            handler.sendMessage(msg);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Avoid leaks by using a non-anonymous handler class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponderHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> OnUserRepoListener mResponder;</span><br><span class="line"></span><br><span class="line">        ResponderHandler(OnUserRepoListener mResponder, Looper looper) {</span><br><span class="line">            <span class="keyword">super</span>(looper);</span><br><span class="line">            <span class="keyword">this</span>.mResponder = mResponder;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">            mResponder.handleMessage(msg);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.xhr.mvpdemo.repository.datasource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.Looper;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xhr.mvpdemo.repository.OnUserRepoListener;</span><br><span class="line"><span class="keyword">import</span> com.xhr.mvpdemo.repository.UserEntity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryUserDataStore</span> <span class="keyword">implements</span> <span class="title">UserDataStore</span> </span>{</span><br><span class="line">    ExecutorService executor = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">    Handler mHandler = <span class="keyword">new</span> Handler();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">(<span class="keyword">final</span> String userName, <span class="keyword">final</span> OnUserRepoListener listener)</span> </span>{</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">if</span> (Looper.myLooper() == Looper.getMainLooper())</span><br><span class="line">                    Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;MainThread&quot;</span>);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;SubThread&quot;</span>);</span><br><span class="line">                UserEntity entity = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (userName.contains(<span class="string">&quot;2&quot;</span>)) {</span><br><span class="line">                    entity = <span class="keyword">new</span> UserEntity();</span><br><span class="line">                    entity.setPassword(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">                    entity.setUserName(userName);</span><br><span class="line">                    <span class="comment">//&#x8C03;&#x7528;handler&#x7684;postMessage&#x901A;&#x77E5;&#x56DE;&#x8C03;</span></span><br><span class="line">                    listener.sendSuccessMessage();</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    listener.sendFailMessage();</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userExist</span><span class="params">(String userName, OnUserRepoListener listener)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (userName.contains(<span class="string">&quot;2&quot;</span>))</span><br><span class="line">            listener.onSuccess();</span><br><span class="line">        listener.onFail();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<blockquote>
<p>AsycHttpClient&#x7EC4;&#x4EF6;&#x91C7;&#x53D6;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x6CD5;&#xFF0C;&#x6548;&#x679C;&#x8F83;&#x597D;&#x3002;&#x4F46;&#x4E5F;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x5C0F;&#x95EE;&#x9898;&#xFF0C;&#x5373;OnRepoListener&#x4E0D;&#x662F;&#x63A5;&#x53E3;&#xFF0C;&#x800C;&#x662F;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x548C;&#x4E00;&#x822C;&#x7684;&#x7406;&#x89E3;&#x4E0D;&#x592A;&#x4E00;&#x81F4;&#x3002;</p>
</blockquote>
<p>&#x65B9;&#x6CD5;&#x4E8C;&#xFF1A;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F20;&#x5165;&#x4E3B;&#x7EBF;&#x7A0B;&#x7684;Handler&#xFF0C;&#x5728;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x56DE;&#x8C03;&#x7684;&#x5730;&#x65B9;&#xFF0C;&#x8C03;&#x7528;Handler.post&#x65B9;&#x6CD5;&#xFF0C;&#x5728;post&#x65B9;&#x6CD5;&#x5185;&#x6267;&#x884C;&#x56DE;&#x8C03;&#xFF0C;&#x6B64;&#x65F6;&#xFF0C;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x6267;&#x884C;</p>
<p>Sample:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhr.mvpdemo.repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xhrong on 2016/1/12.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnUserRepoListener</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">onFail</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhr.mvpdemo.repository.datasource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.Looper;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xhr.mvpdemo.delivery.MessageDelivery;</span><br><span class="line"><span class="keyword">import</span> com.xhr.mvpdemo.repository.OnUserRepoListener;</span><br><span class="line"><span class="keyword">import</span> com.xhr.mvpdemo.repository.UserEntity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryUserDataStore</span> <span class="keyword">implements</span> <span class="title">UserDataStore</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MessageDelivery messageDelivery;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MemoryUserDataStore</span><span class="params">(MessageDelivery messageDelivery)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.messageDelivery = messageDelivery;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUser</span><span class="params">(<span class="keyword">final</span> String userName, <span class="keyword">final</span> OnUserRepoListener listener)</span> </span>{</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">if</span> (Looper.myLooper() == Looper.getMainLooper())</span><br><span class="line">                    Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;MainThread&quot;</span>);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;SubThread&quot;</span>);</span><br><span class="line">                UserEntity entity = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (userName.contains(<span class="string">&quot;2&quot;</span>)) {</span><br><span class="line">                    entity = <span class="keyword">new</span> UserEntity();</span><br><span class="line">                    entity.setPassword(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">                    entity.setUserName(userName);</span><br><span class="line">                    <span class="comment">//&#x56DE;&#x8C03;</span></span><br><span class="line">                    messageDelivery.deliveryMessage(<span class="keyword">new</span> Runnable() {</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                            listener.onSuccess();</span><br><span class="line">                        }</span><br><span class="line">                    });</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    messageDelivery.deliveryMessage(<span class="keyword">new</span> Runnable() {</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                            listener.onSuccess();</span><br><span class="line">                        }</span><br><span class="line">                    });</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">userExist</span><span class="params">(String userName, OnUserRepoListener listener)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (userName.contains(<span class="string">&quot;2&quot;</span>))</span><br><span class="line">            listener.onSuccess();</span><br><span class="line">        listener.onFail();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xhr.mvpdemo.delivery;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.Looper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by xhrong on 2016/1/14.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageDelivery</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Handler mHandler;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageDelivery</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">new</span> Handler(Looper.getMainLooper()));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageDelivery</span><span class="params">(Handler handler)</span> </span>{</span><br><span class="line">        mHandler = handler;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliveryMessage</span><span class="params">(Runnable runnable)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mHandler != <span class="keyword">null</span>)</span><br><span class="line">            mHandler.post(runnable);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDataStoreFactory</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDataStoreFactory</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create {<span class="doctag">@link</span> UserDataStore} from a user id.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDataStore <span class="title">create</span><span class="params">(Class clazz)</span> </span>{</span><br><span class="line">        UserDataStore userDataStore=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;UserDataStoreFactory getName&quot;</span>, clazz.getName());</span><br><span class="line">        <span class="keyword">if</span>(clazz==MemoryUserDataStore<span class="class">.<span class="keyword">class</span>)</span>{</span><br><span class="line">            userDataStore=<span class="keyword">new</span> MemoryUserDataStore(<span class="keyword">new</span> MessageDelivery());</span><br><span class="line">        }<span class="keyword">else</span> {</span><br><span class="line">          <span class="comment">//  userDataStore=new DiskUserDataStore();</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> userDataStore;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x8BE5;&#x65B9;&#x6CD5;&#x5C06;Handler&#x4E0E;&#x63A5;&#x53E3;&#x5B9A;&#x4E49;&#x5206;&#x79BB;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x5DE5;&#x5382;&#x7C7B;&#x4F20;&#x9012;&#x7ED9;&#x5B50;&#x7EBF;&#x7A0B;&#xFF0C;&#x76F8;&#x5BF9;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#x3002;&#x4F46;&#x662F;&#x4FDD;&#x8BC1;&#x4E86;&#x56DE;&#x8C03;&#x63A5;&#x53E3;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5E38;&#x89C4;&#x7684;&#x63A5;&#x53E3;&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#xFF0C;&#x7B26;&#x5408;&#x4E00;&#x822C;&#x4E60;&#x60EF;&#x3002;Volley&#x91C7;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x3002;</p>
</blockquote>
<p>&#x65B9;&#x6CD5;&#x4E09;&#xFF1A;&#x5229;&#x7528;RxJava&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x3002;</p>
<p>Sample</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(userName)</span><br><span class="line">             .map(<span class="keyword">new</span> Func1&lt;String, User&gt;() {</span><br><span class="line">                 <span class="meta">@Override</span></span><br><span class="line">                 <span class="function"><span class="keyword">public</span> User <span class="title">call</span><span class="params">(String s)</span> </span>{<span class="comment">//&#x8FD9;&#x91CC;&#x5728;&#x5B50;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;</span></span><br><span class="line">                     <span class="keyword">if</span> (Looper.myLooper() == Looper.getMainLooper())</span><br><span class="line">                         Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;MainThread&quot;</span>);</span><br><span class="line">                     <span class="keyword">else</span></span><br><span class="line">                         Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;SubThread&quot;</span>);</span><br><span class="line">                     <span class="keyword">if</span> (s.equals(<span class="string">&quot;xhrong&quot;</span>)) {</span><br><span class="line">                         User user = <span class="keyword">new</span> User();</span><br><span class="line">                         user.login = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">                         user.email = <span class="string">&quot;test&quot;</span>;</span><br><span class="line">                         user.id = <span class="number">0</span>;</span><br><span class="line">                         <span class="keyword">return</span> user;</span><br><span class="line">                     } <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                 }</span><br><span class="line">             })</span><br><span class="line">             .subscribeOn(Schedulers.newThread())</span><br><span class="line">             .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">             .subscribe(<span class="keyword">new</span> Subscriber&lt;User&gt;() {<span class="comment">//&#x8FD9;&#x91CC;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x8FD0;&#x884C;</span></span><br><span class="line">                 <span class="meta">@Override</span></span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">                 }</span><br><span class="line"></span><br><span class="line">                 <span class="meta">@Override</span></span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>{</span><br><span class="line">                     listener.onFail();</span><br><span class="line">                 }</span><br><span class="line"></span><br><span class="line">                 <span class="meta">@Override</span></span><br><span class="line">                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(User s)</span> </span>{</span><br><span class="line">                     <span class="keyword">if</span> (Looper.myLooper() == Looper.getMainLooper())</span><br><span class="line">                         Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;MainThread&quot;</span>);</span><br><span class="line">                     <span class="keyword">else</span></span><br><span class="line">                         Log.e(<span class="string">&quot;MemoryUserDataStore.getUser&quot;</span>, <span class="string">&quot;SubThread&quot;</span>);</span><br><span class="line">                     listener.onSuccess();</span><br><span class="line">                 }</span><br><span class="line">             });</span><br></pre></td></tr></table></figure>
<h3 id="2&#x3001;Future&#x6A21;&#x5F0F;&#x7684;&#x95EE;&#x9898;"><a href="#2&#x3001;Future&#x6A21;&#x5F0F;&#x7684;&#x95EE;&#x9898;" class="headerlink" title="2&#x3001;Future&#x6A21;&#x5F0F;&#x7684;&#x95EE;&#x9898;"></a>2&#x3001;Future&#x6A21;&#x5F0F;&#x7684;&#x95EE;&#x9898;</h3><p>Future&#x6A21;&#x5F0F;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>&#x5B50;&#x7EBF;&#x7A0B;&#x548C;&#x4E3B;&#x7EBF;&#x7A0B;&#x5207;&#x6362;</li>
<li>&#x5B50;&#x7EBF;&#x7A0B;&#x5411;&#x4E3B;&#x7EBF;&#x7A0B;&#x56DE;&#x4F20;&#x6570;&#x636E;</li>
</ul>
<p>&#x4F46;&#x662F;&#x5B58;&#x5728;&#x4EE5;&#x4E0B;&#x95EE;&#x9898;&#xFF1A;<br>Future.get()&#x65B9;&#x6CD5;&#x4F1A;&#x963B;&#x585E;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#xFF0C;&#x4F46;&#x662F;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x5F88;&#x96BE;&#x628A;&#x63E1;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Future future = <span class="keyword">this</span>.userDataStore.getUser(userName, listener);</span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">//&#x8BBE;&#x7F6E;&#x8D85;&#x65F6;&#xFF0C;&#x6700;&#x591A;&#x7B49;&#x5F85;15s&#x3002;&#x5728;&#x6B64;&#x671F;&#x95F4;UI&#x7EBF;&#x7A0B;&#x88AB;&#x963B;&#x585E;&#x3002;-----&#x6240;&#x4EE5;&#xFF0C;Future&#x5E76;&#x4E0D;&#x5E38;&#x7528;&#x3002;</span></span><br><span class="line">    UserEntity userEntity = (UserEntity) future.get(<span class="number">15000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">    <span class="keyword">return</span> userEntity;</span><br><span class="line">} <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">    ex.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<blockquote>
<p>&#x5EFA;&#x8BAE;&#xFF1A;&#x4E0D;&#x8981;&#x4F7F;&#x7528;Future&#x8003;&#x8651;&#x4F7F;&#x7528;Tips1&#x4E2D;&#x7684;&#x65B9;&#x6CD5;&#x66FF;&#x4EE3;</p>
</blockquote>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/架构/" rel="tag"># 架构</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/24/JMS和AMQP对比/" rel="next" title="JMS和AMQP对比">
                <i class="fa fa-chevron-left"></i> JMS和AMQP对比
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/11/24/沈园旧事/" rel="prev" title="沈园旧事">
                沈园旧事 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"xhrong"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/24/Android架构设计/" data-title="Android架构设计" data-url="http://xhrong.github.io/2016/11/24/Android架构设计/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="xhrong">
          <p class="site-author-name" itemprop="name">xhrong</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">78</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">130</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Android架构设计"><span class="nav-number">1.</span> <span class="nav-text">Android架构设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Part1：基础组件"><span class="nav-number">1.1.</span> <span class="nav-text">Part1：基础组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RxJava-amp-RxAndroid"><span class="nav-number">1.1.1.</span> <span class="nav-text">RxJava&amp;RxAndroid</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dagger"><span class="nav-number">1.1.2.</span> <span class="nav-text">Dagger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Retrofit"><span class="nav-number">1.1.3.</span> <span class="nav-text">Retrofit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dataBinder"><span class="nav-number">1.1.4.</span> <span class="nav-text">dataBinder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#图片加载库"><span class="nav-number">1.1.5.</span> <span class="nav-text">图片加载库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Universal-Image-Loader"><span class="nav-number">1.1.5.1.</span> <span class="nav-text">Universal Image Loader</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Picasso"><span class="nav-number">1.1.5.2.</span> <span class="nav-text">Picasso</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Volley-ImageLoader"><span class="nav-number">1.1.5.3.</span> <span class="nav-text">Volley ImageLoader</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fresco"><span class="nav-number">1.1.5.4.</span> <span class="nav-text">Fresco</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Glide"><span class="nav-number">1.1.5.5.</span> <span class="nav-text">Glide</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part2：MVP（Model-View-Presenter）"><span class="nav-number">1.2.</span> <span class="nav-text">Part2：MVP（Model-View-Presenter）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理"><span class="nav-number">1.2.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sample"><span class="nav-number">1.2.2.</span> <span class="nav-text">Sample</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part3：MVC"><span class="nav-number">1.3.</span> <span class="nav-text">Part3：MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Android中的MVC"><span class="nav-number">1.3.2.</span> <span class="nav-text">Android中的MVC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sample-1"><span class="nav-number">1.3.3.</span> <span class="nav-text">Sample</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVC-与-MVP区别"><span class="nav-number">1.3.4.</span> <span class="nav-text">MVC 与 MVP区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part4：MVVM"><span class="nav-number">1.4.</span> <span class="nav-text">Part4：MVVM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理-2"><span class="nav-number">1.4.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sample-2"><span class="nav-number">1.4.2.</span> <span class="nav-text">Sample</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVC-gt-MVP-gt-MVVM演进过程"><span class="nav-number">1.4.3.</span> <span class="nav-text">MVC-&gt;MVP-&gt;MVVM演进过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part5：Clean-Architecture"><span class="nav-number">1.5.</span> <span class="nav-text">Part5：Clean Architecture</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Presentation-Layer"><span class="nav-number">1.5.1.</span> <span class="nav-text">Presentation Layer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Domain-Layer"><span class="nav-number">1.5.2.</span> <span class="nav-text">Domain Layer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Data-Layer"><span class="nav-number">1.5.3.</span> <span class="nav-text">Data Layer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Error-Handling"><span class="nav-number">1.5.4.</span> <span class="nav-text">Error Handling</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Part6：Tips"><span class="nav-number">1.6.</span> <span class="nav-text">Part6：Tips</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1、子线程回调更新UI问题"><span class="nav-number">1.6.1.</span> <span class="nav-text">1、子线程回调更新UI问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2、Future模式的问题"><span class="nav-number">1.6.2.</span> <span class="nav-text">2、Future模式的问题</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xhrong</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"xhrong"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("u4DTaPHSLi7UfAEx97rmGGkO-gzGzoHsz", "qEYRUuSsKEaUPpt8BwlMXnbr");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
